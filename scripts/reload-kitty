#!/bin/bash

# Trigger kitty config reload
if pgrep -x kitty &> /dev/null; then
  kitty_addresses=$(hyprctl clients -j | jq -r '.[] | select(.class == "kitty") | .address')
  
  if [[ -n "$kitty_addresses" ]]; then
    # Save current active window or workspace
    current_window=$(hyprctl activewindow -j | jq -r '.address')
    current_workspace=$(hyprctl activeworkspace -j | jq -r '.id')
    
    # Focus each kitty window and send reload key combo
    while IFS= read -r address; do
      hyprctl dispatch focuswindow "address:$address"
      sleep 0.1
      hyprctl dispatch sendshortcut "CTRL SHIFT, F5, address:$address"
    done <<< "$kitty_addresses"
    
    # Return focus to original window or workspace
    if [[ -n "$current_window" && "$current_window" != "null" ]]; then
      hyprctl dispatch focuswindow "address:$current_window"
    else
      hyprctl dispatch workspace "$current_workspace"
    fi
  fi
fi
